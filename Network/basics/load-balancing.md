# 로드 밸런싱(LB; Load Balancing)

> 2024.07.25 목요일 수업😎

오늘 배워볼 주제는 `로드 밸런싱(Load Balancing)`으로, 직역하자면 **Load**(=부하, 짐)을 **Balance**(=균형)있게 나누는 작업을 의미해요. 

- **🥬 샐러리쿵야:** 일이 너무 많으면 힘드니까 나누는거군요!!? 

맞아요. 우리도 해야할 일이 너무 많을 때는, 일의 특성에 따라 우선순위를 정리한 뒤에 차례대로 일을 처리하거나, 도와줄 사람을 모아 일을 분담하기도 하잖아요? 서버도 똑같아요. 한정된 자원을 가지고 처리해야되는 일이 너무 많아지면 힘드니까 여러 컴퓨터를 모아서 할 일을 나누거나, 또는 일을 처리하는 서버 컴퓨터의 하드웨어 성능을 올려서 더 똑똑하게 만들어요. 이 때, 전자를 `Scale-out`이라고 하고, 후자를 `Scale-up`이라고 구분해요.

- **🥬 샐러리쿵야:** 할일을 밖으로 뿌려서 다른 애들한테 일을 나누는 것이 `Scale-out`, 혼자 일을 할 수 있도록 성장시켜서 일을 처리하게 하는 것이 `Scale-up`!! 잘 이해했어요. 

오~ 좋아요! 그렇게 비유하니 더 이해가 쉬울 것 같네요. 하지만 `Scale-up`의 경우 아무리 성능을 올리고 똑똑하게 만들어도 한계가 존재하기 때문에, 많은 사용자들이 이용하는 대규모 서비스인 경우 `Scale-out`이 적절해요. 그러므로 지금부터는 `Scale-out` 위주로 설명할게요. 그건 그렇고, 우리 쿵야 학생은 쉴 때 뭐 하고 놀아요? 

- **🥬 샐러리쿵야:** 핸드폰으로 게임하거나……. 유튜브 봐요 ㅎ.ㅎ 

쌤은 어릴때 티비로 만화 보거나 모래성 쌓고 놀았는데 … ㅎㅎㅎ 역시 세대차이는 무시 못해요 😂 

- **🥬 샐러리쿵야:** ☕라떼는 …….

쿵야 학생이 이번주에 복습을 열심히 했다면 게임이나 유튜브 시청 등 이 모든 과정이 브라우저와 같은 클라이언트가 요청사항을 담아서 웹 서버에 전달하면, 서버가 처리한 결과를 응답 받아서 보여준 다는 것을 알 수 있을거에요. 그리고 그 과정속에는 `HTTP`와 `TCP/IP` 통신이 이루어지고 있다는도 마찬가지구요.

- **🥬 샐러리쿵야:** … 네?

😂 잘 모르겠으면 이번 주 과정을 다시 복습하기로!!

- **🥬 샐러리쿵야:** … 와 갑자기 기억이 나요. 배운 것 같아요.

그..렇죠? 아무튼 우리가 웹 서버에 접속을 요청하면 그 전에 위치한 로드 밸런서가 어느 웹 서버가 놀고 있는지, 어디가 좀 더 스케쥴이 비어있는지 체크해서 요청을 분산해준답니다. 아까 대규모 서비스의 경우 `Scale-out`이 더 적절하다고 했잖아요? 이 경우에는 여러 개의 서버 중에 한대가 고장이 나도 다른 서버로 보내주면 되니까 더 많이 사용되고 있어요.

* **🥬 샐러리쿵야:** 오호라.. 쌤 그럼 일의 중요도를 어떻게 알고 나눠요? 

좋은 질문이에요. 로드 밸런서가 서로 다른 클라이언트 요청에 가장 적합한 서버를 결정하기 위한 규칙을 `로드 밸런싱 알고리즘(Load Balancing Algorithm)`이라고 하는데요. 크게 2가지로 나뉘어요. 고정된 규칙을 따르는 **정적 로드 밸런싱 알고리즘**과 서버의 현재 상태를 검사한 뒤 그에 맞는 규칙을 따르는 **동적 로드 밸런싱 알고리즘**이 있어요.

* **🥬 샐러리쿵야:** 엥, 알고리즘? 벌써 하기 싫어요.

학생.. 진정해.. 상세하게 다루진 않을테니 걱정말고 따라와요~ 

**정적 로드 밸런싱 알고리즘**은 `라운드 로빈(Round Robin)`, `가중 라운드 로빈(Weighted Round Robin)`, `IP 해시(IP Hash)` 등의 방식이 있는데요. 요청이 들어온 순서대로 배정하거나, IP 주소를 `해싱(Hashing)`하여 항상 똑같은 웹 서버로 연결하는 등 정해진 규칙대로 배정하는 것을 말하구요.

**동적 로드 밸런싱 알고리즘**은  `최소 연결(Least Connection)`, `최소 응답 시간(Least Response Time)` 등의 방식이 있어요. 현재 연결된 요청의 수가 몇 개인지, 누가 가장 빨리 일을 처리하는지 등의  요청이 들어왔을 때 서버의 상태를 동적으로 검사한 뒤에 알맞은 서버에 배정을 하는 방식이에요.

- **🥬 샐러리쿵야:** … 네?

ㅎㅎ… 마지막으로 로드 밸런싱의 종류를 설명할게요. 로드 밸런싱은 `OSI 7 계층(OSI 7 Layer)`을 기준으로 부하를 어떻게 분산할지에 따라 종류가 나뉘어요. 이는 네트워크 통신 기능을 7개의 계층으로 나눈 개념인데, 2계층을 기준으로 부하를 분산하면 L2이고 7계층을 기준으로 부하를 분산한다면 L7이라고 해요. 상위 계층은 하위 계층의 데이터를 모두 가지기 때문에 더 섬세하게 작업을 분산 할 수 있지만 가격이 조금 더 비싸요. 

그 중에서도 가장 많이 사용되는 종류가 `L4`와 `L7`이에요. `L4`는 Port, IP 주소를 이용해서 로드 밸런싱을 할 수 있어요. 그리고 가장 상위 계층인 `L7`에서는 Port, IP 주소 뿐만아니라 URL, HTTP Header의 Cookie 값 등을 모두 확인 후에 로드 밸런싱을 수행해요. 이건 어려우니까 나중에 OSI 7 계층을 따로 공부해 보는 것도 추천해요! 

- **🥬 샐러리쿵야:** 갑자기 훅 들어오시네요. 로드 밸런싱하는데 왜 네트워크 모든 지식을 다 배우는 느낌이죠? ㅜ^ㅜ

😂 😂 오늘의 수업은 여기까지에요. 고생 많았어요! 


<br/>

## 정리 노트

> [!Tip]
> 참고 문헌 
>
> * [로드 밸런싱이란 무엇인가요? - AWS](https://aws.amazon.com/ko/what-is/load-balancing/)
> * [로드 밸런싱이란? - IBM](https://www.ibm.com/kr-ko/topics/load-balancing)
> * [\[Network\] 로드 밸런서(LB) - 정의, 역할, 로드밸런싱 알고리즘](https://chunsubyeong.tistory.com/106)

### 로드 밸런서(Load Balancer)란?

> 트래픽을 여러 서버나 서비스로 분산시키는 하드웨어 또는 소프트웨어

- 주요 기능
  - 들어오는 요청을 여러 서버로 나누어 한 서버에 과부하가 걸리지 않도록 트래픽 분산
  - 특정 서버에 문제가 생기면 다른 서버로 트래픽을 전환하여 가용성을 유지
  - 사용자의 요청을 항상 같은 서버로 보내서 세션을 유지
- 종류
  - OSI 계층 모델의 작동 레벨에 따라 나눌 수 있으며, L4와 L7이 가장 많이 활용됨
  - 소프트웨어 로드밸런서는 Nginx, HAProxy 등이 있음
  - L4 로드 밸런서 
    - 전송 계층(4 Layer)
    - IP 주소, Port 번호를 기반으로 트래픽 분산
    - TCP/UDP 트래픽을 처리하는데 적합하며, 패킷 레벨에서 작동하기 때문에 데이터 내용에 접근하지 않음
  - L7 로드 밸런서
    - 응용 계층(7 Layer)
    - HTTP Header, URL, Cookie 등의 데이터를 기반으로 트래픽 분산
    - 세밀한 트래픽 제어가 가능하며, 콘텐츠 기반 라우팅, 세션 지속성, SSL 종료 등의 기능을 제공함

### 로드 밸런싱(Load Balancing)이란?

> 트래픽을 여러 서버나 리소스에 고르게 분산시키는 기술

- 로드 밸런싱 알고리즘
  - 정적 알고리즘
    - 라운드 로빈(Round Robin): 요청을 순서대로 각 서버에 분배
    - 가중 라운드 로빈(Weghted Round Robin): 서버에 가중치를 부여하여, 가중치가 높은 서버에 많은 요청을 처리하도록 분배
    - IP 해싱(IP Hashing): 클라이언트 IP 주소를 해싱(Hashing)하여 특정 서버에만 연결이 되도록 분배
  - 동적 알고리즘
    - 최소 연결(Least Connection): 요청이 들어온 시점에 가장 적은 연결을 유지하고 있는 서버에 요청을 전송하는 방식
    - 최소 응답 시간(Least Response Time): 서버의 연결 상태, 응답 시간을 모두 고려하여 가장 적은 연결 수와 가장 짧은 응답 시간을 가지는 서버에 우선적으로 요청을 보내는 방식
